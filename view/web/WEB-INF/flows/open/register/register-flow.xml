<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.springframework.org/schema/webflow"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow
       http://www.springframework.org/schema/webflow/spring-webflow-2.4.xsd">

    <on-start>
        <evaluate expression="userRegistrationFlowActions.createUserRegistration()"
                  result="flowScope.merchantRegistrationForm"/>
    </on-start>

    <view-state id="details" model="merchantRegistrationForm">
        <transition on="submit" to="validateUserDetails"/>
    </view-state>

    <action-state id="validateUserDetails">
        <evaluate expression="userRegistrationValidation.validateUserDetails(merchantRegistrationForm, messageContext)"/>
        <transition on="success" to="verification"/>
        <transition on="failure" to="details"/>
    </action-state>

    <view-state id="verification">
        <!-- discard history to prevent back flow, invalidate to prevent back flow for all states -->
        <transition on="confirm" to="completeSignUp" history="invalidate"/>
        <transition on="cancel" to="invitationCancel"/>
    </view-state>

    <action-state id="completeInvite">
    </action-state>

    <end-state id="logout" view="externalRedirect:contextRelative:/open/login.htm"/>

    <global-transitions>
        <transition on="cancel" to="logout"/>
    </global-transitions>

</flow>